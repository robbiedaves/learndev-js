# NPM - Node Package Manager

NPM is the package manager used by node.js applications.
It is like Maven for Java.
The two interfaces you will interact with are
* The NPM Website - https://npmjs.com
* The NPM command line toolkit

You can search for packages on the NPM website but here the focus will be on the command line interface (CLI)

To run the CLI you simply type
```
npm
```

Note: NPM is bundled with Node so you don't have to install it. However, if you want to use a specific NPM version then you can update it. 
For example, if you want to install NPM version 3 then type ```npm install npm@3 -g```

First create a new project folder and set up the following strucuture:
```
|--- app
|       |--- index.js
|--- index.js
```

the root index.js should be simply
```js
require('./app/index')
```

The index.js in the app folder should be:
```
// app/index.js

const result = "My Node application using NPM"
console.log(result) 
```

Now add (in the root folder) package.json that looks like this:
```json
{
  "name": "learndev-js-node-npm",
  "version": "1.0.0",
  "description": "This is from the following tutorial:\r https://blog.risingstack.com/node-hero-npm-tutorial/",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
	"start": "node index.js"
  },
  "author": "Robin Davies",
  "license": "ISC"
}
```

We went through the basics of a node application in the hello section.

## Adding Dependencies
In this section we are going to add runtime dependencies
For this example, we will use the lodash package which is a collection of utilities (see: https://lodash.com/)
Type the following on the command line (at the project root)
```
npm install lodash --save 
```

2 things have just happened
* loadsh has been downloaded and placed in the node_modules folder. This is where all the external dependencies will be stored.
* the depenency has been added to your package.json file

Firstly, if we are using GIT then we don't want the node_modules folder saved in version control, so we need to add this to the .gitignore file.
Here is a .gitignore example you should consider using:
```
# Logs
logs
*.log
npm-debug.log*

# Runtime data
pids
*.pid
*.seed

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# node-waf configuration
.lock-wscript

# Compiled binary addons (http://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules
jspm_packages

# Optional npm cache directory
.npm

# Optional REPL history
.node_repl_history
```

After you've created the .gitignore file in your root directory, have a look at the package.json file again.
```
{
  "name": "learndev-js-node-npm",
  "version": "1.0.0",
  "description": "This is from the following tutorial:\r https://blog.risingstack.com/node-hero-npm-tutorial/",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "start": "node index.js"
  },
  "author": "Robin Davies",
  "license": "ISC",
  "dependencies": {
    "lodash": "^4.17.4"
  }
}
```
You can see that lodash has been added as a depenency. 
Lodash is now installed and ready to be used.

Edit the index.js (in /app folder) and change it to this:
```js
// app/index.js

const result = "My Node application using NPM"
console.log(result) 

const _ = require('lodash')

_.forEach([1, 2], function(value) {
  console.log(value);
});
// => Logs `1` then `2`.
```

Then type on the command line
```
node index.js
```

You should see the following output:
```
My Node application using NPM
1
2
```


## Adding Development Dependencies
When building web applications, you may need to minify your JavaScript files, concatenating CSS files and so on. 
The modules that will do it will be only ran during the building of the assets, so the running application doesn't need them.

You can install such scripts with:
```
npm install mocha --save-dev  
```

The following section has been added to the package.json file:
```
  "devDependencies": {
    "mocha": "^3.3.0"
  }
```

Modules you install with --save-dev will be put in the node_modules directory.


## NPM Scripts
The most common scripts are the start and the test scripts. 
With the start you can define how one should start your application, while test is for running tests. In your package.json they can look something like this:
```
  "scripts": {
    "start": "node index.js",
    "test": "mocha test",
    "your-custom-script": "echo npm"
  }
```
### Notes
* start: pretty straightforward, it just describes the starting point of your application, it can be invoked with npm start
* test: the purpose of this one is to run your tests - one gotcha here is that in this case mocha doesn't need to be installed globally, as npm will look for it in the node_modules/.bin folder, and mocha will be placed there as well. It can be invoked with: npm test.
* your-custom-script: anything that you want, you can pick any name. It can be invoked with npm run your-custom-script - don't forget the run part!

## Scoped / Private Packages
Originally NPM had a global shared namespace for module names - with more than 250.000 modules in the registry most of the simple names are already taken. 
Also, the global namespace contains public modules only.

NPM addressed this problem with the introduction of scoped packages. Scoped packages has the following naming pattern:

```
@myorg/mypackage
```

You can install scoped packages the same way as you did before:

```
npm install @myorg/mypackage --save-dev  
```

It will show up in your package.json in the following way:

```
"dependencies": {
  "@myorg/mypackage": "^1.0.0"
}
```

Requiring scoped packages works as expected:

```
require('@myorg/mypackage')  
```
